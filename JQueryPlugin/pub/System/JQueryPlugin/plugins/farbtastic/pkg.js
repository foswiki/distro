!function(t){jQuery.fn.farbtastic=function(e){return t.farbtastic(this,e),this},jQuery.farbtastic=function(e,o){return(e=t(e).get(0)).farbtastic||(e.farbtastic=new jQuery._farbtastic(e,o))},jQuery._farbtastic=function(e,o){var a=this;t(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var r=t(".farbtastic",e);a.wheel=t(".wheel",e).get(0),a.radius=84,a.square=100,a.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&t("*",r).each((function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),t(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}})),a.linkTo=function(e){return"object"==typeof a.callback&&t(a.callback).off("keyup",a.updateValue),a.color=null,"function"==typeof e?a.callback=e:"object"!=typeof e&&"string"!=typeof e||(a.callback=t(e),a.callback.on("keyup",a.updateValue),a.callback.get(0).value&&a.setColor(a.callback.get(0).value)),this},a.updateValue=function(t){this.value&&this.value!=a.color&&a.setColor(this.value)},a.setColor=function(t){var e=a.unpack(t);return a.color!=t&&e&&(a.color=t,a.rgb=e,a.hsl=a.RGBToHSL(a.rgb),a.updateDisplay()),this},a.setHSL=function(t){return a.hsl=t,a.rgb=a.HSLToRGB(t),a.color=a.pack(a.rgb),a.updateDisplay(),this},a.widgetCoords=function(e){var o,r,n=e.target||e.srcElement,s=a.wheel;if(void 0!==e.offsetX){for(var i={x:e.offsetX,y:e.offsetY},c=n;c;)c.mouseX=i.x,c.mouseY=i.y,i.x+=c.offsetLeft,i.y+=c.offsetTop,c=c.offsetParent;c=s;for(var u={x:0,y:0};c;){if(void 0!==c.mouseX){o=c.mouseX-u.x,r=c.mouseY-u.y;break}u.x+=c.offsetLeft,u.y+=c.offsetTop,c=c.offsetParent}for(c=n;c;)c.mouseX=void 0,c.mouseY=void 0,c=c.offsetParent}else{i=a.absolutePosition(s);o=(e.pageX||0*(e.clientX+t("html").get(0).scrollLeft))-i.x,r=(e.pageY||0*(e.clientY+t("html").get(0).scrollTop))-i.y}return{x:o-a.width/2,y:r-a.width/2}},a.mousedown=function(e){document.dragging||(t(document).on("mousemove",a.mousemove).on("mouseup",a.mouseup),document.dragging=!0);var o=a.widgetCoords(e);return a.circleDrag=2*Math.max(Math.abs(o.x),Math.abs(o.y))>a.square,a.mousemove(e),!1},a.mousemove=function(t){var e=a.widgetCoords(t);if(a.circleDrag){var o=Math.atan2(e.x,-e.y)/6.28;o<0&&(o+=1),a.setHSL([o,a.hsl[1],a.hsl[2]])}else{var r=Math.max(0,Math.min(1,-e.x/a.square+.5)),n=Math.max(0,Math.min(1,-e.y/a.square+.5));a.setHSL([a.hsl[0],r,n])}return!1},a.mouseup=function(){t(document).off("mousemove",a.mousemove),t(document).off("mouseup",a.mouseup),document.dragging=!1},a.updateDisplay=function(){var e=6.28*a.hsl[0];t(".h-marker",r).css({left:Math.round(Math.sin(e)*a.radius+a.width/2)+"px",top:Math.round(-Math.cos(e)*a.radius+a.width/2)+"px"}),t(".sl-marker",r).css({left:Math.round(a.square*(.5-a.hsl[1])+a.width/2)+"px",top:Math.round(a.square*(.5-a.hsl[2])+a.width/2)+"px"}),t(".color",r).css("backgroundColor",a.pack(a.HSLToRGB([a.hsl[0],1,.5]))),"object"==typeof a.callback?(t(a.callback).css({backgroundColor:a.color,color:a.hsl[2]>.5?"#000":"#fff"}),t(a.callback).each((function(){this.value&&this.value!=a.color&&(this.value=a.color)}))):"function"==typeof a.callback&&a.callback.call(a,a.color)},a.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var o=a.absolutePosition(t.offsetParent);e.x+=o.x,e.y+=o.y}return e},a.pack=function(t){var e=Math.round(255*t[0]),o=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(e<16?"0":"")+e.toString(16)+(o<16?"0":"")+o.toString(16)+(a<16?"0":"")+a.toString(16)},a.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},a.HSLToRGB=function(t){var e,o,a=t[0],r=t[1],n=t[2];return e=2*n-(o=n<=.5?n*(r+1):n+r-n*r),[this.hueToRGB(e,o,a+.33333),this.hueToRGB(e,o,a),this.hueToRGB(e,o,a-.33333)]},a.hueToRGB=function(t,e,o){return 6*(o=o<0?o+1:o>1?o-1:o)<1?t+(e-t)*o*6:2*o<1?e:3*o<2?t+(e-t)*(.66666-o)*6:t},a.RGBToHSL=function(t){var e,o,a,r,n,s,i=t[0],c=t[1],u=t[2];return e=Math.min(i,Math.min(c,u)),a=(o=Math.max(i,Math.max(c,u)))-e,n=0,(s=(e+o)/2)>0&&s<1&&(n=a/(s<.5?2*s:2-2*s)),r=0,a>0&&(o==i&&o!=c&&(r+=(c-u)/a),o==c&&o!=u&&(r+=2+(u-i)/a),o==u&&o!=i&&(r+=4+(i-c)/a),r/=6),[r,n,s]},t("*",r).on("mousedown",a.mousedown),a.setColor("#000000"),o&&a.linkTo(o)}}(jQuery),function(t){var e={fade:250,position:"bottom",callback:function(t){}};function o(t,e,o){var a,r,n,s,i,c,u,l,f,d,h=function(t){var e=/^rgb\((.*?),(.*?),(.*?)\)/;return 7===t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4===t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:e.test(t)?[parseFloat(t.replace(e,"$1")/255),parseFloat(t.replace(e,"$2")/255),parseFloat(t.replace(e,"$3")/255)]:t}(t);return(l=(a=h)[0],f=a[1],d=a[2],r=Math.min(l,Math.min(f,d)),s=(n=Math.max(l,Math.max(f,d)))-r,c=0,(u=(r+n)/2)>0&&u<1&&(c=s/(u<.5?2*u:2-2*u)),i=0,s>0&&(n===l&&n!==f&&(i+=(f-d)/s),n===f&&n!==d&&(i+=2+(d-l)/s),n===d&&n!==l&&(i+=4+(l-f)/s),i/=6),[i,c,u])[2]>.5?e||"#000":o||"#FFF"}function a(e,a){var r,n=a.val();function s(t){var e=o(t);a.val(t).css({"background-color":t,color:e})}return r=t.farbtastic(e).linkTo(s),n&&(s(n),r.setColor(n)),r}t((function(){var o=t("#colorpicker");0===o.length&&(o=t('<div class="ui-component-content ui-widget-content ui-hidden ui-helper-hidden" id="colorpicker"></div>').appendTo("body")),t(".jqFarbtastic:not(.jqInitedFarbtastic)").livequery((function(){var r,n=t(this),s=t.extend({},e,n.data());n.addClass("jqInitedFarbtastic"),r=a(o,n),n.on("click",(function(){var t,e;function i(){var a;0===n.length&&e?window.clearInterval(e):(a=n.offset(),"left"===s.position&&(a.left+=n.outerWidth()),"bottom"===s.position&&(a.top+=n.outerHeight()),t&&t.top===a.top&&t.left===a.left||(t=a,o.css({top:a.top,left:a.left})))}r=a(o,n),i(),e=window.setInterval(i,500),o.farbtastic().fadeIn(s.fade)})).on("blur",(function(){o.farbtastic().hide(),"function"==typeof s.callback&&s.callback.call(r,r.color)}))}))})),t((function(){var e={dark:"#000",light:"#fff"};t(".jqFarbtasticFG:not(.jqInitedFarbtasticFG)").livequery((function(){var a=t(this),r=t.extend({},e,a.data()),n=o(a.css("background-color"),r.dark,r.light);a.addClass("jqInitedFarbtastic").css({color:n})}))}))}(jQuery);
