%META:TOPICINFO{author="ProjectContributor" date="1183830381" format="1.1" version="$Rev$"}%
---+ IF Statements

The =%<nop>IF%= construct gives TWiki the power to include content in topics based on the value of simple expressions.

=%<nop>IF{"CONDITION" then="THEN" else="ELSE"}%=

In the example above, if CONDITION evaluates to TRUE, then THEN will be included in the topic; otherwise ELSE will be included.

Note that because of the way TWiki evaluates, then whatever is in the THEN and ELSE parameters will already have been expanded by the time the condition is actually evaluated. The standard FormatTokens can be used in the THEN and ELSE parameters when you need to delay evaluation of (for example) a TWiki variable.

The basic syntax of a condition is the same as [[QuerySearch][the syntax used for queries]], with the addition of the following special operators:

| context | True if the current context is set (see below) |
| allows | ='X' allows 'Y'= is true if web/topic 'X' exists and allows access mode 'Y' for the current user. Web access rights are only checked if there is no topic called 'X'. |
| istopic | =istopic 'X'= is true if topic 'X' exists |
| isweb | =isweb 'X'= is true if web 'X' exists |
| ingroup | ='X' ingroup 'Y'= is true if user 'X' is in group 'Y'. 'X' can be a login name or a wikiname. |
| defined | True if a preference variable or url parameter of this name is defined. |
| isempty | True if a preference variable, url parameter or session variable of this name has an empty value. It is equivalent to the expression =(!defined(x) || $x='')= |
| $ | expands a URL parameter or [[TWikiVariables][TWikiVariable]] name. Plugin handlers *are not called*. Built-in variables and user-defined preferences are supported. You can pass a limited subset of parameters to TWiki variables by enclosing the variable name in single quotes; for example, =$ 'VARIABLE{value}'=. The ='VARIABLE{value}'= string may *not* contain quotes (' or "). |
| {X} | expands to the value of the configuration variable {X} - for example, ={ScriptUrlPath}= |

__Examples:__

1. TWiki variable defined or not
<verbatim>
%IF{"defined 'WIKINAME'" then="WIKINAME is defined" else="WIKINAME is not defined"}%
</verbatim>

2. Compare TWiki variable
<verbatim>
You are %IF{ "$ WIKINAME='WikiGuest' and not defined 'OPEN_DAY'" then="not" }% allowed to
%IF{ "context view" then="view" else="edit"}% this TWiki today.
</verbatim>

3. URL parameter
<verbatim>
%IF{ "defined 'search'" then="Search: $percntURLPARAM{search}$percnt" else="No search passed in"}%
</verbatim>

4. Range test on URL parameter
<verbatim>
url param t is %IF{ "0 < $ t and $ t < 1000" then="in" else="out of"}% range.
</verbatim>

5. Text comparison of URL parameter
<verbatim>
%IF{ "$'URLPARAM{scope}'='text'" then="Plain text search" }% 
</verbatim>

6. Configuration item set or not
<verbatim>
%IF{ "{AntiSpam}{HideUserDetails}" then="User details are hidden" }%
</verbatim>

7. Plugin enabled test
<verbatim>
TablePlugin is %IF{ "context TablePluginEnabled" then="enabled" else="disabled" }%.
</verbatim>
expands to: %BR%
TablePlugin is %IF{ "context TablePluginEnabled" then="enabled" else="disabled" }%.

8. Check access permissions
<verbatim>
You %IF{"'%TOPIC%' allows 'change'" then="can" else="cannot"}% change this topic.
You %IF{"'Sandbox.TestTopic' allows 'change'" then="can" else="cannot"}% change Sandbox.TestTopic.
You %IF{"'Sandbox' allows 'change'" then="can" else="cannot"}% change Sandbox web
</verbatim>
expands to: %BR%
You %IF{"'%TOPIC%' allows 'change'" then="can" else="cannot"}% change this topic.
You %IF{"'Sandbox.TestTopic' allows 'change'" then="can" else="cannot"}% change Sandbox.TestTopic.
You %IF{"'Sandbox' allows 'change'" then="can" else="cannot"}% change Sandbox web

9. Check topic existance
<verbatim>
Topic Sandbox.TestTopic %IF{"istopic 'Sandbox.TestTopic'" then="exists" else="does not exist"}%
Web Sandbox.TestTopic %IF{"isweb 'Sandbox'" then="exists" else="does not exist"}%
</verbatim>
expands to: %BR%
Topic Sandbox.TestTopic %IF{"istopic 'Sandbox.TestTopic'" then="exists" else="does not exist"}%
Web Sandbox.TestTopic %IF{"isweb 'Sandbox'" then="exists" else="does not exist"}%

10. Group membership
<verbatim>
You %IF{"'%USERNAME%' ingroup 'WikiAdminGroup'" then="are an admin" else="are a normal user"}% 
</verbatim>
expands to: %BR%
You %IF{"'%USERNAME%' ingroup 'WikiAdminGroup'" then="are an admin" else="are a normal user"}% 

*Configuration items* are defined in [[%SCRIPTURLPATH{"configure"}%][configure]]. You cannot see the value of a configuration item, you can only see if the item is set or not.

*Context identifiers* are used in TWiki to label various stages of the rendering process. They are especially useful for [[Skins][skin]] authors to find out where they are in the rendering process. The following context identifiers are available:
| *id* | *context* |
| absolute_urls | Set if absolute URLs are required |
| attach | in attach script (see TWikiScripts) |
| authenticated | a user is authenticated |
| body_text  | when the body text is being processed in a view (useful in plugin handlers) |
| can_login | current environment supports login |
| changes | in changes script (see TWikiScripts) |
| command_line | the running script was run from the command line, and not from CGI |
| diff | in rdiff script (see TWikiScripts) |
| edit | in edit script (see TWikiScripts) |
| footer_text | when the footer text is being processed in a view (useful in plugin handlers) |
| header_text | when the header text is being processed in a view (useful in plugin handlers) |
| i18n_enabled | when user interface <nop>I18N support is enabled (i.e., user can choose the language for UI) |
| inactive | if active links such as 'edit' and 'attach' should be disabled |
| login & logon | in login / logon script (see TWikiScripts) |
| manage | in manage script (see TWikiScripts) |
| mirror | if this is a mirror |
| new_topic | if the topic doesn't already exist |
| oops | in oops script (see TWikiScripts) |
| preview | in preview script (see TWikiScripts) |
| register | in register script (see TWikiScripts) |
| rename | in rename script (see TWikiScripts) |
| resetpasswd | in resetpasswd script (see TWikiScripts) |
| rss | if this is an RSS skin rendering |
| save | in save script (see TWikiScripts) |
| search | in search script (see TWikiScripts) |
| statistics | in statistics script (see TWikiScripts) |
| textareas_hijacked | provided for use by editors that highjack textareas, and want to signal this fact. This is used by skins, for example, so they can suppress extra controls when textareas have been hijacked. |
| upload | in upload script (see TWikiScripts) |
| view | in view script (see TWikiScripts) |
| viewfile | in viewfile script (see TWikiScripts) |
| rest | in rest script (see TWikiScripts) |
| registration_supported | registration is supported by the current UserMapper |
| registration_enabled | set if ={Register}{EnableNewUserRegistration}= is on, and registrationis supported |
| passwords_modifyable | set if the password manager support changing the password / email |

In addition there is a context identifier for each enabled plugin; for example, if =Gallous<nop>BreeksPlugin= is installed *and enabled*, then the context ID =Gallous<nop>BreeksPluginEnabled= will be set. Other extensions may set additional context identifiers.

The =%<nop>IF%= statement is deliberately kept simple. In particular, note that there is no way to conditionally execute a Set statement. If you need more sophisticated control over formatting, then consider using the SpreadSheetPlugin.

Note also that while the [[QuerySearch][query syntax]] can be used to access form fields, there are some contexts in which an IF statement may be used where there is no topic context, or the topic context is not what you expected.
